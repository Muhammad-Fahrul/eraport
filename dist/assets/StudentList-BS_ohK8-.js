import{P as C,r as h,b as k,u as A,j as e,L as b,g as q}from"./index-C4EYCwQF.js";import{B as D}from"./ButtonIcon-BiBhuHw3.js";import{a as E,b as I,c as O}from"./studentApiSlice-GuZAa6lx.js";import{E as T}from"./Error-f4fWrvck.js";const F=({studentId:o})=>{const t=k(),{student:r}=E("studentList",{selectFromResult:({data:s})=>({student:s==null?void 0:s.entities[o]})}),i=A(),l=()=>{t(`${r.username}`,{state:{from:i}})};let d=e.jsx("li",{className:"container-student",children:e.jsx("div",{className:"top",children:e.jsx("p",{className:"description",onClick:l,children:r.username})})});return e.jsx(e.Fragment,{children:d})};F.propTypes={studentId:C.string.isRequired};const B=h.memo(F),U=({setScreen:o})=>{var c;const[t,r]=h.useState(""),[i,l]=h.useState(""),[d,{isLoading:s,isError:x,error:u}]=I(),p=a=>{a.preventDefault(),(async()=>{try{const j=await d({username:t,password:i}).unwrap();o(!1),alert(`${j.message}`),r(""),l("")}catch{alert(`${t} gagal ditambahkan`)}})()};return e.jsxs(e.Fragment,{children:[b&&s,e.jsxs("form",{onSubmit:a=>p(a),className:"wrapper",children:[e.jsxs("div",{className:"title",style:{textAlign:"center"},children:[e.jsx("h1",{style:{fontSize:"1em"},children:"New Student"}),e.jsx("p",{style:{opacity:x?1:0,color:"red",fontSize:"0.6rem",width:"200px"},children:(c=u==null?void 0:u.data)==null?void 0:c.message})]}),e.jsxs("div",{className:"inputBox",children:[e.jsx("input",{name:"username",type:"text",required:"required",value:t,onChange:a=>r(a.target.value)}),e.jsx("span",{children:"Username"})]}),e.jsxs("div",{className:"inputBox",children:[e.jsx("input",{name:"password",type:"text",required:"required",value:i,onChange:a=>l(a.target.value)}),e.jsx("span",{children:"Password"})]}),e.jsx("button",{className:"enter",children:"Add"})]})]})};U.propTypes={setScreen:C.func.isRequired};function M(){var p;const[o,t]=h.useState(null),[r,{isLoading:i,isSuccess:l,isError:d,error:s}]=O(),x=c=>{t(c.target.files[0])},u=async c=>{if(c.preventDefault(),!o)return alert("Please upload a file");const a=new FormData;a.append("file",o);try{await r(a).unwrap(),t(null)}catch(g){console.error("Failed to upload file: ",g)}};return e.jsxs("form",{onSubmit:u,className:"wrapper",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file",children:"Upload CSV file:"}),e.jsx("input",{type:"file",id:"file",accept:".csv",onChange:x})]}),e.jsx("button",{type:"submit",disabled:i,children:i?"Uploading...":"Upload"}),l&&e.jsx("p",{children:"Users added successfully!"}),d&&e.jsxs("p",{children:["Error: ",((p=s==null?void 0:s.data)==null?void 0:p.message)||"Failed to upload file"]})]})}const Q=()=>{var w,y;const[o,t]=h.useState(!1),[r,i]=h.useState(!0),[l,d]=h.useState(""),s=q(),{data:x,isSuccess:u,isLoading:p,isError:c,error:a}=E("studentList",{pollingInterval:6e4,refetchOnFocus:!0,refetchOnMountOrArgChange:!0}),g=f=>{f.target.className==="container-student-new"&&(t(!1),i(!1))};let j;if(p)return e.jsx(b,{});if(u){const{ids:f,entities:S}=x;let N,v;if(s.isStudent){const n=(w=Object.values(S).find(m=>m.username.toLocaleLowerCase()===s.username.toLocaleLowerCase()))==null?void 0:w.id;v=Object.values(S).filter(m=>m.username.toLocaleLowerCase()!==s.username.toLocaleLowerCase()),N=f.filter(m=>m!==n)}else v=S,N=f;let L=Object.values(v).map(n=>{if(l.length){if(n.username.toLocaleLowerCase().includes(l.toLocaleLowerCase()))return n.id}else return n.id}).filter(n=>n!==void 0).map(n=>N.filter(m=>m===n)[0]);j=L.length?L.map(n=>e.jsx(B,{studentId:n},n)):e.jsx("h4",{children:"No Student"})}else if(c)return e.jsx(T,{message:(y=a.data)==null?void 0:y.message});return e.jsxs("div",{className:"container-students",children:[e.jsx("h3",{children:"STUDENTS"}),e.jsxs("form",{className:"form-search",children:[e.jsx("span",{className:"search-icon-container",children:e.jsx("i",{className:"fa-solid fa-magnifying-glass"})}),e.jsx("input",{type:"search",placeholder:"Search by Name",onChange:f=>d(f.target.value),value:l})]}),e.jsx("ul",{className:"students",children:j}),o&&e.jsxs("div",{className:"container-student-new",onClick:g,children:[r?e.jsx(U,{setScreen:t}):e.jsx(M,{}),e.jsxs("button",{style:{padding:".1em",width:"200px",color:"blue"},onClick:()=>{i(!r)},children:["add ",r?"multipe user here":"single user here"]})]}),s.isMentor&&e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>t(!0),children:e.jsx(D,{text:"NEW",children:e.jsx("i",{className:"fa-solid fa-plus"})})})})]})};export{Q as default};
