import{P as f,r as i,j as e,u as I,g as T,f as _}from"./index-C4EYCwQF.js";import{B as q}from"./ButtonIcon-BiBhuHw3.js";import{Record as B}from"./Record-B2A3bDgg.js";import{R as C,u as V,a as A}from"./RecordDetail-Dtv8sDy6.js";import D from"./Back-DHOhBcRb.js";const E=({raportStatus:l,records:t})=>{const[N,c]=i.useState({}),[u,h]=i.useState(!1),g=t[0].studentId,p=t[0].raportId,R=i.useCallback(r=>{const s=t.find(a=>a._id===r);c(s),h(!0)},[t]),d=r=>Object.entries(r[0]).map(([s])=>{if(s!=="_id"&&s!=="studentId"&&s!=="raportId"&&s!=="updatedAt"&&s!=="__v")return s==="createdAt"?"Tanggal":s}).filter(s=>s!==void 0);let n,b=e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"info"}),d(t).map(r=>r.length>5?e.jsx("th",{children:`${r.slice(0,5)}...`},r):e.jsx("th",{children:r},r))]}),x=t.map(r=>e.jsx("tr",{children:e.jsx(B,{record:r,handleDetail:R})},r._id));return e.jsxs("div",{children:[e.jsx("div",{className:"container-table-raport",children:e.jsxs("table",{className:"table-raport",children:[e.jsx("thead",{children:e.jsx("tr",{children:b})}),e.jsx("tbody",{children:x})]})}),n,u&&e.jsx(C,{studentId:g,raportId:p,raportStatus:l,record:N,setScreen:h})]})};E.propTypes={raportStatus:f.bool.isRequired,records:f.array.isRequired};const F=(l,t)=>l.raportStatus===t.raportStatus&&l.records.length===t.records.length,L=i.memo(E,F),S=({studentId:l,raportId:t,columns:N,setScreenNR:c})=>{var r;const[u,h]=i.useState({}),[g,{isSuccess:p,isError:R,error:d}]=V(),n=(s,a,m)=>{h(j=>{if(m==="checkbox"){const v=j[s]||[],o=v.includes(a)?v.filter(y=>y!==a):[...v,a];return{...j,[s]:o}}return{...j,[s]:a}})},b=async s=>{s.preventDefault();try{await g({studentId:l,raportId:t,...u})}catch(a){console.log(a.data)}};i.useEffect(()=>{p&&c(!1)},[p,c]);let x=N.map(s=>s.columnType==="boolean"?e.jsx("div",{className:"inputBox",children:e.jsxs("select",{required:!0,onChange:a=>n(s.columnName,a.target.value),children:[e.jsxs("option",{value:"",children:["--",s.columnName,"--"]}),e.jsx("option",{value:s.trueValue,children:s.trueValue}),e.jsx("option",{value:s.falseValue,children:s.falseValue})]})},s._id):s.columnType==="array"?e.jsxs("div",{className:"inputBox",children:[e.jsx("label",{htmlFor:"",children:s.columnName}),e.jsx("div",{className:"array-opt",children:s.arrayValues.map(a=>e.jsxs("div",{className:"array-item",children:[e.jsx("input",{type:"checkbox",value:a,name:a,id:a,onChange:m=>n(s.columnName,m.target.value,"checkbox")}),e.jsx("label",{htmlFor:a,children:a})]},a))})]},s._id):e.jsxs("div",{className:"inputBox",children:[e.jsx("label",{htmlFor:s.columnName,children:s.columnName}),e.jsx("input",{type:s.columnType,onChange:a=>n(s.columnName,a.target.value)})]},s._id));return e.jsx("div",{className:"container-raport-new",children:e.jsxs("form",{className:"wrapper",onSubmit:b,children:[R&&e.jsx("p",{children:((r=d==null?void 0:d.data)==null?void 0:r.message)||"muat ulang"}),x,e.jsx("span",{className:"close",onClick:()=>c(!1),children:e.jsx("i",{className:"fa-solid fa-circle-xmark"})}),e.jsx("button",{className:"enter",children:"Add"})]})})};S.propTypes={studentId:f.string.isRequired,raportId:f.string.isRequired,columns:f.array.isRequired,setScreenNR:f.func.isRequired};const O=()=>{var m,j;const l=I(),t=T(),[N,c]=i.useState(!1),{username:u,raportId:h}=_(),{data:g,isSuccess:p,isLoading:R,isError:d,error:n}=A({username:u,raportId:h}),b=((m=l.state)==null?void 0:m.from.pathname)||"/";let x,r,s,a;if(R)r=e.jsx("p",{children:"loading..."});else if(p){const{student:v,raport:o,records:y}=g;x=e.jsx("span",{children:o.name}),r=y.length?e.jsx(L,{raportStatus:o.status,records:y}):e.jsx("p",{children:"Kosong"}),s=N&&o.status&&e.jsx(S,{studentId:v._id,raportId:o._id,columns:o.columns,setScreenNR:c}),a=(t==null?void 0:t.isMentor)&&o.status&&e.jsx("div",{onClick:()=>c(!0),children:e.jsx(q,{text:"NEW",children:e.jsx("i",{className:"fa-solid fa-plus"})})})}else if(d)return e.jsx("p",{children:(j=n==null?void 0:n.data)==null?void 0:j.message});return e.jsxs("div",{className:"container-raport",children:[e.jsxs("div",{className:"top",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"username",children:e.jsx("span",{children:u})}),x]}),e.jsx(D,{previousPath:b})]}),r,s,a]})};export{O as default};
