import{r as t,j as e,L as E,e as k,d as b}from"./index-C4EYCwQF.js";import{e as A,c as $}from"./raportApiSlice-C9xJUIGH.js";const F=()=>{const s=t.useRef(null),[a,l]=t.useState(!1),[c,{isSuccess:n,isLoading:d,isError:h,error:p}]=A(),i=async m=>{m.preventDefault();try{await c({raportName:s.current.value})}catch(j){console.log(j)}};t.useEffect(()=>{n&&(alert(`skema ${s.current.value} berhasil ditambahkan`),s.current.value="")},[n,s]);let u;return d&&(u=e.jsx(E,{})),h&&alert(p.data.message),e.jsxs("div",{className:"add-new-form-section",children:[e.jsx("h3",{children:"Create Raport"}),e.jsx("section",{className:`${a&&"focus"}`,children:e.jsxs("form",{action:"",children:[e.jsx("input",{autoComplete:"off",ref:s,type:"text",name:"raportName",id:"raportName",onFocus:()=>l(!0),onBlur:()=>l(!1),placeholder:"Book Name",required:!0}),u,e.jsx("button",{className:"add-new-input",onClick:m=>{s&&i(m)},children:e.jsx("i",{className:"fa-solid fa-plus"})})]})})]})},y="/api/collaborators",T=k.injectEndpoints({endpoints:s=>({addCollaborator:s.mutation({query:a=>({url:`${y}`,method:"POST",body:a}),invalidatesTags:["User"]}),getCollaboratorsByUsername:s.query({query:a=>`${y}?username=${a}`}),getCollabsByMentor:s.query({query:()=>`${y}/collabs`})})}),{useAddCollaboratorMutation:U,useLazyGetCollaboratorsByUsernameQuery:_,useGetCollabsByMentorQuery:q}=T,P=(s,a)=>{const[l,c]=t.useState(s);return t.useEffect(()=>{const n=setTimeout(()=>{c(s)},a);return()=>{clearTimeout(n)}},[s,a]),l};function D(){var v,S;const[s,a]=t.useState(""),[l,c]=t.useState(""),[n,d]=t.useState([]),h=P(s,300),[p,i]=t.useState(!1),[u,{isLoading:m,isSuccess:j,isError:f,error:o}]=U(),[N,{isLoading:L,isError:R,error:g}]=_(),C=t.useCallback(async r=>{try{const{users:x}=await N(r).unwrap();d(x)}catch(x){console.error("Failed to fetch collaborators: ",x)}},[N]),B=(r,x)=>{a(x),c(r),d([])},w=async r=>{if(r.preventDefault(),!l)return alert("Please select a valid collaborator");try{await u({collaboratorId:l}).unwrap(),a(""),c(""),d([])}catch(x){console.error("Failed to add collaborator: ",x)}};return t.useEffect(()=>{h?C(h):d([])},[h,C]),e.jsxs("div",{className:"add-new-form-section",children:[e.jsx("h3",{children:"Add Collaborator"}),e.jsx("section",{className:`${p&&"focus"}`,children:e.jsxs("form",{onSubmit:w,className:"collaborator-form",children:[e.jsx("input",{type:"text",id:"username",value:s,onFocus:()=>i(!0),onBlur:()=>i(!1),placeholder:"Collaborator username",onChange:r=>a(r.target.value)}),e.jsx("button",{type:"submit",disabled:m,className:"add-new-input",children:e.jsx("i",{className:"fa-solid fa-plus"})})]})}),L&&e.jsx("p",{children:"Loading..."}),j&&e.jsx("p",{className:"success",children:"Collaborator added successfully!"}),f&&e.jsx("p",{className:"error",children:((v=o==null?void 0:o.data)==null?void 0:v.message)||"Failed to add collaborator"}),n.length>0&&e.jsx("ul",{className:"collaborator-list",children:n.map(r=>e.jsx("li",{onClick:()=>B(r._id,r.username),children:`${r.username} - ${r._id}`},r._id))}),R&&e.jsx("p",{className:"error",children:((S=g==null?void 0:g.data)==null?void 0:S.message)||"Failed to fetch collaborators"})]})}const G=()=>{const{data:s,isSuccess:a,isLoading:l,isError:c,error:n}=$(),{data:d,isSuccess:h,isLoading:p}=q();let i,u;if(l||p)i=e.jsx("p",{children:"Loading..."}),u=e.jsx("p",{children:"Loading..."});else if(a||h){const{raports:j}=s,{collaborators:f}=d;i=j.length?j.map(o=>e.jsx("li",{children:e.jsx(b,{to:`/mentor/raports/${o._id}`,children:e.jsxs("div",{className:o.valid?"valid":"invalid",children:[e.jsx("h4",{children:o.name}),e.jsx("span",{children:o.valid?"valid":"invalid"})]})})},o._id)):e.jsx("h4",{children:"Tidak ada raport"}),u=f.length?f.map(o=>e.jsx("li",{children:e.jsx("div",{className:"valid",children:e.jsx("h4",{children:o.username})})},o._id)):e.jsx("h4",{children:"Tidak ada collaborator"})}else c&&(i=e.jsx("p",{children:n.data.message}));let m=e.jsxs("div",{className:"wrapper",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Santri"}),e.jsx(b,{to:"/mentor/students",children:e.jsxs("h5",{children:["Santri ",e.jsx("i",{className:"fa-solid fa-angles-right"})]})})]}),e.jsxs("div",{children:[e.jsx(F,{}),e.jsxs("div",{className:"books",children:[e.jsx("h3",{children:"Raports"}),e.jsx("ul",{children:i})]})]}),e.jsxs("div",{children:[e.jsx(D,{}),e.jsxs("div",{className:"collabs",children:[e.jsx("h3",{children:"Collaborators"}),e.jsx("ul",{children:u})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Analytics"}),e.jsx(b,{to:"/mentor/reports",children:e.jsxs("h5",{children:["Reports ",e.jsx("i",{className:"fa-solid fa-angles-right"})]})}),e.jsx(b,{to:"/mentor/reports/array",children:e.jsxs("h5",{children:["Reports By Array ",e.jsx("i",{className:"fa-solid fa-angles-right"})]})})]})]});return e.jsx("div",{className:"container-dashboard",children:m})};export{G as default};
